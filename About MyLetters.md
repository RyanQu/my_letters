##关于"MyLetters"
Date: 2016-10-08  
Author: RyQ

###关于MEE杯
MEE杯刚刚结束了作品提交，2016-2017学年工作坊的第一个大活动也就结束了，当然对于技术的探索才刚刚开始。我会陆续把题目所涉及的开发文档和代码发布上来。

自我创建MEE杯作为工作坊招新的一个途径开始，这已经是第三届了，我也大四了，进入了离开这里的倒计时。看着这里的一切趋于成熟又充满生机，想想自己还是做了些事情的，很是欣慰。

给萌新出技术类题目是很困难的，需要用尽量有趣的形式来吸引同学们进入电子或互联网的世界，但需要面对新生不具备任何技术方面的基础，题目又不能太过复杂，同时还希望能培养他们的自学、分析问题、建模、解决问题等各方面的能力。

在不断摸索的过程中也走了不少弯路，比赛办了三年也越发的趋于成熟，可以先来简单感受一下MEE杯历年的题目：  
>2014 第一届MEE杯
>>电子类：  
>>1. 晶体管放大电路（硬件）  
>>2. 运算放大器解方程（硬件）  
>>3. 音乐节奏灯（硬件）  
>>互联网类：  
>>4. 个人简历（前端）  
>>5. 个人简历（安卓）  
>>6. 孪生素数（算法）
>
>2015年 第二届MEE杯
>>电子类：  
>>1. 节奏大师（硬件）  
>>2. Apple Watch（嵌入式）  
>>3. 流光琴（综合）  
>>互联网类：  
>>4. 个人简历（前端）  
>>5. 时光机（安卓）  
>>6. 正常的数字大冒险（算法）
>
>2016年 第三届MEE杯
>>电子类：  
>>1. 防盗报警系统（综合，硬件为主）  
>>2. 打地鼠游戏机（综合，嵌入式为主）   
>>互联网类：  
>>3. MySpace（前端）  
>>4. MyLetters（算法）

一个明显的规律就是越来越难了，也是我们对于很多新生的热情估计不足，每年都出现了提前做完题目又没事做的同学。比如现在活跃在招新一线岗位上的潘司机，去年做完题目还认认真真写了一份说明书。

题目的包装也更精致了，不再是裸露的技术名词，而是一套相对成熟的小系统。系统区别于技术的一点在于其全局性，在完成一个系统之前需要对系统有全面的认知和理解，能够清晰的分解任务，并对逐个对拆解出来的问题各个击破。这恰恰也是我们希望培养出的一种能力。

MEE杯是在不断寻求变化的，题目是一个很好地体现。很多技术栈被慢慢的减掉了，比如Java Web和Android，一方面是培养难度和时间成本太高，另一方面是市场需求和几年前已有所不同。但比如个人简历这道题目就一直保存着，确实本身题目出的不错（害羞脸），而且从前端作为入口可以学习Javascript或PHP转向全栈，对于以后数据类工作比如爬虫一类的也很有帮助。


之前的两年我一直在做Web，但是也一直都有在出算法题目，虽然当时出的题目也没有什么明确的指向性，因为我也不知道能干吗。在做过一点简单的数据工作之后，今年出的题目明显质量高出了很多。个人感觉，今年的题目中，最有趣、质量最高的题目就是第四题。颇有些自吹自擂的感觉。

这里讲的算法是实用性强、非常简单的、萌新可以写出来的算法，不需要数据结构、图论的知识作为基础。举个栗子，比如2015年我出的题目“正常的数字大冒险”，实质是用C语言写一个具有统计运算功能的计算器，还包括一些简单的矩阵运算。代码本身其实很难讲有什么算法，无非几个for、while、if，但是在做这道题的同时可以理解很多诸如回归、预测、分布之类的知识。在我的理解中，可以实现这些功能的代码片段可以说得上是不错的算法了，利用程序语言以及相应的运算规则解决了实际生活中存在的问题。

铺垫的内容稍微多了一些，主要是来讲MyLetters这道题的。这是今年我为数不多的还算完工的抄袭。

暑假看了RoboMaster觉得特别燃，连一直鄙视大学生动手能力的老曲也全程跟着我在看，传统的比赛形式大都是封闭测试，不精彩也不激烈，一旦加入有趣的比赛规则，有对抗有博弈，才有看头。所以今年的题目，一直想出一道有对战的。

与大一新生开学前的期待和兴奋不同，大四学长在家准备GMAT考试的过程是异常艰辛、枯燥且无聊的。直到某一个风和日丽热的要死想和空调私奔的下午，打开App Store准备看看有什么新的软件上架，发现了它:

**[Letterpress](http://www.letterpressapp.com/)**

用苹果设备的同学可以下载下来感受一下，非常简单却非常有趣的一个单词游戏。用安卓设备的同学……目前这游戏还没有Android版本，可能你需要考虑一下预定一部iPhone7。

![Letterpress](http://static.36kr.com/wp-content/uploads/2012/10/%E7%85%A7%E7%89%873.png)

我在被虐的体无完肤之后，灵光一闪，一个5X5大小的棋盘，如果我有一个合适大小的词库的话，遍历是非常快速的，找住必胜的一些单词组合也不会很复杂。

然后我就开始搞一些坏坏的事情了……之后好像就再没有输过。

可能又是灵光一闪吧，检查了一遍代码，又看了看Github上的开源项目，觉得这个似乎也不是那么复杂……看起来蛮适合给萌新们做题目的。

但是又面临着一个问题，如果利用Letterpress对战是非常不友好的一件事情，一者不是所有人都有苹果设备，二者如果是现场对战的话，从程序到点击输入单词的体验也很差，如果可能的话，尽量不要有人来参与这个过程。

于是就这样，决定自己来开发这样的一个平台，也是自己动手的第一个Laravel项目。

###需求分析
就整个系统而言还是有点复杂的……一步一步来。  

**如何进行游戏？**

从操作流程（即功能）角度审视系统：

1. 由于玩家的程序在PC上跑，输出的单词结果也在PC上，所以游戏平台也应该在PC上，这样更方便操作。因为不会开发桌面应用，所以只好开发网站。
2. 比赛应该是有时间限制的，毕竟是对战，不能像Letterpress一样无限等待。同时也对玩家算法的运行时间和优化提出了要求。
3. 提交单词的方式应该从“点选字母”改为“提交坐标”，这样的话程序输出的结果可以直接提交给服务器或者复制到输入框。
4. 玩家应该在同一台电脑上进行对战。开发时间短，对Ajax也不是很熟悉，如果是双方分开进行的话很难做到同步更新棋盘数据，需要手动刷新，很不友好。比赛时有个中间人进行双方的操作即可。

至此明确了系统需求：一个网站，有棋盘，有输入框，有双方的提交按钮，符合游戏的规则。
  
**有哪些游戏规则？**

从逻辑角度审视系统：

1. 如单词存在，红方则染红色，蓝方则染蓝色。如任意格子与其相邻格子所属一样时，变为深色。
2. 胜负判断：当棋盘被填满或双方都弃权时，比赛结束，所占格子多的一方获胜。
3. 一局比赛中，每个单词只能被使用一次。已使用过的单词的子序列也不能再使用。
4. 在一个单词中，任意坐标只允许使用一次。

第一条规则其实就是一个细思恐极的事情……因为有9种情况，体现在代码里是一个很痛苦的事情。

胜负判断很简单，就是个计数器，不谈了。

子序列校验，也不复杂，读入所有使用过的单词做字符串比对。

坐标不允许重复使用，可以把坐标换算成对应的字符串位置，同一数字不重复就可以了。

看来主要的精力要花在做变色这个事情上了……

**有哪些数据？**  

从数据角度审视系统：

1. 棋盘：长度为25的字符串
2. 指令：用户提交的操作指令
3. 单词：用户提交的单词
4. 词库：用于单词校验的词库
5. 棋盘状态：棋盘当前的颜色状态
6. 游戏ID：一个用户对应一局游戏

考虑到棋盘状态是一个很关键的数据，如果是自动执行的AI的话需要获取这部分数据，应该建一个表来存储。那么棋盘的字符串就不能是每次刷新都Random的，应该是建立一个随机数种子，存储在数据库里，每个game对应一个board。所以棋盘需要建立一张表。

用户提交的指令、单词和单词校验结果，在系统的处理上是顺序的三个步骤，之后需要显示出来。单词和单词校验结果实质上是相关的，如果单词存在，则打印单词，如果单词不存在或不符合规则，则打印提示，比如"False Word!"。这三个因素应该是放到一张表里的。

词库肯定是单独的一张表，这个就不多说了。

游戏ID是后来考虑到的一个问题，在固定游戏ID的情况下，页面应该保持一个棋盘，否则是不能进行游戏的，一刷新就会换一个棋盘。所以需要存在一个gameID和board进行对应。另外，我所有的棋盘都是Random之后存好的，那么就可以遍历所有棋盘，在比赛之前就可以进行运算，这是显然的一个漏洞，也就是说gameID的设置不应该是简单易操作的。考虑到Laravel有自带的Auth系统，就拿这个来做gameID的设计了。

综上，系统应该包含这么一些数据：

1. boards：棋盘数据
2. users：一个user对应一个game
3. words：词库
4. records：记录棋盘当前状态
5. gamelogs：记录玩家操作

###开发准备
考虑到Web响应的部分很简单（因为不打算用Ajax），随便什么语言都可以写的吧，系统运算和负荷对服务器的要求几乎没有……选用Linux+Nginx+MySQL+PHP的开发环境，就放在我的阿里云上就好，不用专门去配置开发环境之类的。

PHP作为非常成熟的后端语言，开发框架多的不要不要的，工作坊长期以来都是使用Laravel的，这是在读过开发文档之后我和SnowZh定下来的，但是好像后台部分一直是SnowZh在做，我还是第一次用Laravel开发。前端部分还是老套路，用Bootstrap，毕竟不是专职做前端的，没有Lumpy同学那么多的花样，只会用这种简单粗暴的快速开发框架。

其他的开发工具挑了几个比较称心的，PHPStorm作为IDE，DataGrip作为数据库的管理软件，先在本地调试，都OK了以后部署到云上。

接下来进行开发准备阶段最重要的工作，**任务分解**：

1. 前端定稿
2. 数据库设计
3. 搭建后台
4. 逻辑规则  
  4.1 初始化棋盘状态  
  4.2 获取命令  
  4.3 检查单词  
  4.4 记录玩家操作  
  4.5 变色  
  4.6 检查深色  
  4.7 胜负校验
5. 测试

具体的开发过程会在下一篇文档“搭建‘MyLetters’平台”中跟大家见面，很快会写好。

